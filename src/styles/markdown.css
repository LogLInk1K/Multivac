/* --- 修正版：保留原色 blockquote + 优化版代码系统 --- */

/* 基础 Prose 容器 */
.prose {
  @apply text-text-light dark:text-text-dark antialiased leading-relaxed;
  max-width: 65ch; 
  word-wrap: break-word;
  overflow-wrap: break-word;
  word-break: break-word;
  hyphens: auto;
  scroll-behavior: smooth;
}

/* --- 标题系统（保留侧边装饰条） --- */
.prose h1 {
  @apply text-4xl font-extrabold tracking-tight text-text-light dark:text-text-dark mb-8 mt-10 pb-4 border-b-2 border-primary-light/20 dark:border-primary-dark/20;
}

.prose h2 {
  @apply text-2xl font-bold text-text-light dark:text-text-dark mb-5 mt-12 flex items-center scroll-mt-24;
}

.prose h2::before {
  content: "";
  @apply mr-3 w-1.5 h-6 bg-primary-light dark:bg-primary-dark rounded-full inline-block;
}

.prose h3 {
  @apply text-xl font-bold text-text-light/90 dark:text-text-dark/90 mb-4 mt-8 flex items-center scroll-mt-24;
}

.prose h3::before {
  content: "";
  @apply mr-3 w-1.5 h-4 bg-primary-light/60 dark:bg-primary-dark/60 rounded-full inline-block;
}

/* --- 正文与链接 --- */
.prose p {
  @apply mb-5 leading-8 text-text-light/90 dark:text-text-dark/90 text-[1.05rem];
}

.prose a {
  @apply text-primary-light dark:text-primary-dark font-semibold no-underline border-b border-primary-light/30 hover:border-primary-light transition-all duration-300;
}

/* --- 引用块：换回你原本的高饱和度色调 --- */
.prose blockquote {
  @apply relative pl-8 pr-8 py-8 my-10 
         bg-primary-light/[0.04] dark:bg-primary-dark/[0.04]
         rounded-2xl shadow-sm border border-primary-light/10 dark:border-primary-dark/10;
}

/* 还原：左上角鲜艳大引号 */
.prose blockquote::before {
  content: "“";
  @apply absolute top-1 left-2 text-6xl text-primary-light dark:text-primary-dark 
         font-serif italic leading-none select-none opacity-100; /* 确保不透明 */
}

/* 还原：右下角鲜艳大引号 */
.prose blockquote::after {
  content: "”";
  @apply absolute bottom-[-25px] right-4 text-6xl text-primary-light dark:text-primary-dark 
         font-serif italic leading-none select-none opacity-100; /* 确保不透明 */
}

.prose blockquote p {
  @apply pl-4 pr-2 text-text-light/80 dark:text-text-dark/80 not-italic leading-7 relative z-10 text-left !important;
  margin: 0 !important;
}

/* --- 代码系统：博文核心 --- */

/* 行内代码：保持醒目但修正行高冲突 */
.prose :not(pre) > code {
  @apply text-[0.9em] font-mono font-medium px-1.5 py-0.5 mx-0.5 rounded-md transition-colors;
  @apply bg-[#425aef] dark:bg-[#ffc848] text-white dark:text-black; 
}

/* 移除自动添加的引号 */
.prose code::before, .prose code::after { content: "" !important; }

/* --- 强化版 IDE 样式：兼容浅色/深色模式 --- */

.prose pre code {
  counter-reset: line; /* 初始化计数器 */
}

.prose pre .line::before {
  counter-increment: line; /* 每一行自增 */
  content: counter(line); /* 显示数字 */
  @apply inline-block w-2 mr-4 text-right text-slate-600 select-none; /* 样式：宽度、间距、不可选 */
}

.prose pre, 
.prose pre code {
  font-family: 'JetBrains Mono', 'Fira Code', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace !important;
}

.prose pre {
  @apply relative mb-8 overflow-x-auto selection:bg-blue-500/30;
  background-color: #161b22 !important; 
  border: 1px solid #30363d !important;
  box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5) !important;
  
  border-radius: 12px !important;
  padding: 0 !important; 
}

/* 代码块头部工具栏 */
.prose pre {
  position: relative;
  overflow-x: auto;
}

.prose pre .code-header {
  @apply flex items-center justify-between px-4 py-2.5 bg-[#0d1117] border-b border-[#30363d] cursor-pointer select-none;
  position: sticky;
  left: 0;
  min-width: 100%;
  width: max-content;
}

.prose pre .code-header .code-title {
  @apply flex items-center gap-2 text-slate-300 text-base font-semibold;
}

.prose pre .code-header .code-title .toggle-icon {
  @apply w-5 h-5 transition-transform duration-200 flex-shrink-0;
}

.prose pre.collapsed .code-header .toggle-icon {
  @apply -rotate-90;
}

.prose pre .code-header .copy-btn {
  @apply flex items-center justify-center p-1.5 text-slate-300 bg-slate-700/60 rounded-md hover:bg-slate-600/60 hover:text-white transition-all flex-shrink-0;
}

.prose pre .code-header .copy-btn svg {
  @apply w-4 h-4 block;
}

.prose pre.copied .copy-btn {
  @apply text-green-400 bg-green-900/40;
}

/* 折叠状态 */
.prose pre.collapsed .code-header {
  @apply rounded-b-xl border-b-0;
}

.prose pre.collapsed code {
  display: none;
}

.prose pre code {
  @apply block px-5 py-4 text-[14px] leading-7 font-mono;
  color: #e6edf3 !important;
  min-width: 100%;
}

/* --- 媒体与表格 --- */
.prose img, .prose video {
  @apply rounded-2xl shadow-xl my-10 mx-auto border border-black/5 dark:border-white/5 transform transition-transform hover:scale-[1.01];
}

.prose img + em {
  @apply block text-center text-sm text-text-light/50 dark:text-text-dark/50 -mt-6 mb-10 not-italic;
}

/* 移除 Tailwind Prose 插件为 blockquote 自动添加的引号 */
.prose blockquote p::before,
.prose blockquote p::after {
  content: "" !important;
}