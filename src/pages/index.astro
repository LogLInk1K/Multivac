---
import MainLayout from '../layouts/MainLayout.astro';
import BlogCard from '../components/BlogCard.astro';
import LeftSidebar from '../components/LeftSidebar.astro';
import RightSidebar from '../components/RightSidebar.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { getCollection, type CollectionEntry } from 'astro:content';

// 获取所有文章并按时间倒序排序
const allPosts = (await getCollection('post', (post: CollectionEntry<'post'>) => !post.data.draft))
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime());

// 分页设置
const postsPerPage = 5;
const currentPage = Number(Astro.params.page) || 1;
const totalPages = Math.ceil(allPosts.length / postsPerPage);

// 计算当前页要显示的文章
const startIndex = (currentPage - 1) * postsPerPage;
const posts = allPosts.slice(startIndex, startIndex + postsPerPage);
---

<MainLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	
	<section class="max-w-[1340px] mx-auto px-4 sm:px-6 lg:px-8 py-16">
			<!-- 响应式布局：小屏幕单列，中等屏幕两栏，大屏幕三栏 -->
			<div class="grid grid-cols-1 md:grid-cols-[272px_1fr] xl:grid-cols-[272px_1fr_272px] gap-6">
				<!-- 左侧边栏：中等屏幕和大屏幕显示 -->
				<div class="hidden md:block">
					<div class="space-y-6">
						<LeftSidebar />
						<!-- 中等屏幕：右侧边栏显示在左侧边栏下方 -->
						<div class="md:block xl:hidden">
							<RightSidebar />
						</div>
					</div>
				</div>

				<!-- 中间内容区：所有屏幕显示 -->
				<div>
					<div class="space-y-6">
						{posts.map((post) => (
							<BlogCard key={post.id} post={post} />
						))}
					</div>

					<!-- 分页控件 -->
					{totalPages > 1 && (
						<div class="flex justify-center mt-12">
							<nav class="inline-flex items-center space-x-2">
								<!-- 上一页按钮 -->
								{currentPage > 1 && (
									<a 
										href={currentPage === 2 ? '/' : `/page/${currentPage - 1}/`} 
										class="px-4 py-2 border border-border-light dark:border-border-dark rounded-3xl text-text-light dark:text-text-dark hover:bg-hover-light dark:hover:bg-hover-dark hover:-translate-y-0.5 hover:shadow-lg transition-all duration-300"
									>
										上一页
									</a>
								)}

								<!-- 页码按钮 -->
								{Array.from({ length: totalPages }, (_, i) => i + 1).map((pageNum) => (
									<a
										href={pageNum === 1 ? '/' : `/page/${pageNum}/`}
										class={`px-4 py-2 border rounded-3xl transition-all duration-300 ${currentPage === pageNum 
											? 'bg-primary-light text-white border-primary-light dark:bg-primary-dark dark:border-primary-dark' 
											: 'bg-card-light dark:bg-card-dark text-text-light dark:text-text-dark border-border-light dark:border-border-dark hover:bg-hover-light dark:hover:bg-hover-dark hover:-translate-y-0.5 hover:shadow-lg'}
										`}
									>
										{pageNum}
									</a>
								))}

								<!-- 下一页按钮 -->
								{currentPage < totalPages && (
									<a
										href={`/page/${currentPage + 1}/`}
										class="px-4 py-2 border border-border-light dark:border-border-dark rounded-3xl text-text-light dark:text-text-dark hover:bg-hover-light dark:hover:bg-hover-dark hover:-translate-y-0.5 hover:shadow-lg transition-all duration-300"
									>
										下一页
									</a>
								)}
							</nav>
						</div>
					)}
				</div>

				<!-- 右侧边栏：大屏幕显示 -->
				<div class="hidden xl:block">
					<RightSidebar />
				</div>
			</div>
	</section>
</MainLayout>
