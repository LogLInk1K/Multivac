---
import MainLayout from '../layouts/MainLayout.astro';
import BlogCard from '../components/BlogCard.astro';
import LeftSidebar from '../components/LeftSidebar.astro';
import RightSidebar from '../components/RightSidebar.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { getCollection } from 'astro:content';

// 获取所有文章并按时间倒序排序
const allPosts = (await getCollection('blog', { filter: (post) => !post.data.draft }))
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime());

// 分页设置
const postsPerPage = 5;
const currentPage = Number(Astro.params.page) || 1;
const totalPages = Math.ceil(allPosts.length / postsPerPage);

// 计算当前页要显示的文章
const startIndex = (currentPage - 1) * postsPerPage;
const posts = allPosts.slice(startIndex, startIndex + postsPerPage);
---

<MainLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	
	<section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">

			<!-- 大屏幕：三栏布局 -->
			<!-- 中等屏幕：侧边栏上下排列在左，内容在右 -->
			<!-- 小屏幕：单列堆叠 -->
			<div class="grid grid-cols-1 gap-8">
				<!-- 大屏幕三栏布局 -->
				<div class="hidden xl:grid grid-cols-[256px_1fr_256px] gap-8">
					<!-- 左侧边栏 -->
					<div>
						<LeftSidebar />
					</div>

					<!-- 中间内容区 -->
					<div>
						<div class="grid grid-cols-1 gap-8">
							{posts.map((post) => (
								<BlogCard key={post.id} post={post} />
							))}
						</div>

						<!-- 分页控件 -->
						{totalPages > 1 && (
							<div class="flex justify-center mt-12">
								<nav class="inline-flex items-center space-x-2">
									<!-- 上一页按钮 -->
									{currentPage > 1 && (
										<a 
											href={currentPage === 2 ? '/' : `/page/${currentPage - 1}/`} 
											class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
										>
											上一页
										</a>
									)}

									<!-- 页码按钮 -->
									{Array.from({ length: totalPages }, (_, i) => i + 1).map((pageNum) => (
										<a
											key={pageNum}
											href={pageNum === 1 ? '/' : `/page/${pageNum}/`}
											class={`px-4 py-2 border rounded-md transition-colors ${currentPage === pageNum 
												? 'bg-blue-600 text-white border-blue-600' 
												: 'bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border-slate-300 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700'}
											`}
										>
											{pageNum}
										</a>
									))}

									<!-- 下一页按钮 -->
									{currentPage < totalPages && (
										<a
											href={`/page/${currentPage + 1}/`}
											class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
										>
											下一页
										</a>
									)}
								</nav>
							</div>
						)}
					</div>

					<!-- 右侧边栏 -->
					<div>
						<RightSidebar />
					</div>
				</div>

				<!-- 中等屏幕布局 -->
				<div class="hidden md:grid lg:grid xl:hidden grid-cols-[256px_1fr] gap-8">
					<!-- 侧边栏堆叠区 -->
					<div class="space-y-8">
						<LeftSidebar />
						<RightSidebar />
					</div>

					<!-- 内容区域 -->
					<div class="grid grid-cols-1 gap-8">
						{posts.map((post) => (
							<BlogCard key={post.id} post={post} />
						))}
					</div>



					<!-- 分页控件 -->
					{totalPages > 1 && (
						<div class="flex justify-center mt-12">
							<nav class="inline-flex items-center space-x-2">
								<!-- 上一页按钮 -->
								{currentPage > 1 && (
									<a 
										href={currentPage === 2 ? '/' : `/page/${currentPage - 1}/`} 
										class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
									>
										上一页
									</a>
								)}

								<!-- 页码按钮 -->
								{Array.from({ length: totalPages }, (_, i) => i + 1).map((pageNum) => (
									<a
										key={pageNum}
										href={pageNum === 1 ? '/' : `/page/${pageNum}/`}
										class={`px-4 py-2 border rounded-md transition-colors ${currentPage === pageNum 
											? 'bg-blue-600 text-white border-blue-600' 
											: 'bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border-slate-300 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700'}
										`}
									>
										{pageNum}
									</a>
								))}

								<!-- 下一页按钮 -->
								{currentPage < totalPages && (
									<a
										href={`/page/${currentPage + 1}/`}
										class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
									>
										下一页
									</a>
								)}
							</nav>
						</div>
					)}
				</div>

				<!-- 小屏幕布局 -->
				<div class="md:hidden space-y-8">
					<LeftSidebar />
					<div class="grid grid-cols-1 gap-8">
						{posts.map((post) => (
							<BlogCard key={post.id} post={post} />
						))}
					</div>

					<!-- 分页控件 -->
					{totalPages > 1 && (
						<div class="flex justify-center mt-12">
							<nav class="inline-flex items-center space-x-2">
								<!-- 上一页按钮 -->
								{currentPage > 1 && (
									<a 
										href={currentPage === 2 ? '/' : `/page/${currentPage - 1}/`} 
										class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
									>
										上一页
									</a>
								)}

								<!-- 页码按钮 -->
								{Array.from({ length: totalPages }, (_, i) => i + 1).map((pageNum) => (
									<a
										key={pageNum}
										href={pageNum === 1 ? '/' : `/page/${pageNum}/`}
										class={`px-4 py-2 border rounded-md transition-colors ${currentPage === pageNum 
											? 'bg-blue-600 text-white border-blue-600' 
											: 'bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border-slate-300 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700'}
										`}
									>
										{pageNum}
									</a>
								))}

								<!-- 下一页按钮 -->
								{currentPage < totalPages && (
									<a
										href={`/page/${currentPage + 1}/`}
										class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
									>
										下一页
									</a>
								)}
							</nav>
						</div>
					)}

					<RightSidebar />
				</div>
			</div>
	</section>
</MainLayout>
