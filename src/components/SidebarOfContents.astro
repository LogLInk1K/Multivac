---
---

<!-- 侧边功能图标组 - 与目录水平对称 -->
<div
  id="sidebar-of-contents"
  class="hidden xl:flex fixed top-1/2 -translate-y-1/2 left-[max(4rem,calc((100vw-1340px)/2-2rem))] z-40 flex-col gap-4"
>
  <!-- 返回顶部按钮 -->
  <div
    id="back-to-top"
    class="flex items-center justify-end w-[180px] group/bar cursor-pointer opacity-0 transition-opacity duration-500 relative"
    aria-label="返回顶部"
  >
    <!-- 提示信息框 -->
    <div class="absolute right-12 px-3 py-1.5 rounded-lg bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark shadow-lg opacity-0 group-hover/bar:opacity-100 transition-all duration-300 pointer-events-none whitespace-nowrap translate-x-2 group-hover/bar:translate-x-0">
      <span class="text-sm font-medium text-text-light dark:text-text-dark">返回顶部</span>
      <!-- 小三角形指示器 -->
      <div class="absolute right-[-6px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent border-l-[6px] border-l-border-light dark:border-l-border-dark"></div>
      <div class="absolute right-[-5px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[5px] border-t-transparent border-b-[5px] border-b-transparent border-l-[5px] border-l-card-light dark:border-l-card-dark"></div>
    </div>
    <!-- 圆形背景 + 向上箭头图标 -->
    <div class="w-10 h-10 rounded-full bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark flex items-center justify-center group-hover/bar:bg-primary-light/10 dark:group-hover/bar:bg-primary-dark/10 group-hover/bar:border-primary-light/40 dark:group-hover/bar:border-primary-dark/40 transition-all duration-300 shadow-md hover:shadow-lg">
      <svg
        class="w-5 h-5 text-text-light/60 dark:text-text-dark/60 group-hover/bar:text-primary-light dark:group-hover/bar:text-primary-dark transition-all duration-300"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M5 10l7-7m0 0l7 7m-7-7v18"
        ></path>
      </svg>
    </div>
  </div>

  <!-- 分享按钮（占位，始终显示） -->
  <div
    id="share-button"
    class="flex items-center justify-end w-[180px] group/bar cursor-pointer opacity-100 transition-opacity duration-500 relative"
    aria-label="分享"
  >
    <!-- 提示信息框 -->
    <div class="absolute right-12 px-3 py-1.5 rounded-lg bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark shadow-lg opacity-0 group-hover/bar:opacity-100 transition-all duration-300 pointer-events-none whitespace-nowrap translate-x-2 group-hover/bar:translate-x-0">
      <span class="text-sm font-medium text-text-light dark:text-text-dark">分享</span>
      <!-- 小三角形指示器 -->
      <div class="absolute right-[-6px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent border-l-[6px] border-l-border-light dark:border-l-border-dark"></div>
      <div class="absolute right-[-5px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[5px] border-t-transparent border-b-[5px] border-b-transparent border-l-[5px] border-l-card-light dark:border-l-card-dark"></div>
    </div>
    <!-- 圆形背景 + 分享图标 -->
    <div class="w-10 h-10 rounded-full bg-card-light dark:bg-card-dark backdrop-blur-sm border border-border-light dark:border-border-dark flex items-center justify-center group-hover/bar:bg-primary-light/10 dark:group-hover/bar:bg-primary-dark/10 group-hover/bar:border-primary-light/30 dark:group-hover/bar:border-primary-dark/30 transition-all duration-300 shadow-md hover:shadow-lg">
      <svg
        class="w-5 h-5 text-text-light/60 dark:text-text-dark/60 group-hover/bar:text-primary-light dark:group-hover/bar:text-primary-dark transition-all duration-300"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"
        ></path>
      </svg>
    </div>
  </div>

  <!-- 打赏按钮（占位，始终显示） -->
  <div
    id="reward-button"
    class="flex items-center justify-end w-[180px] group/bar cursor-pointer opacity-100 transition-opacity duration-500 relative"
    aria-label="打赏"
  >
    <!-- 提示信息框 -->
    <div class="absolute right-12 px-3 py-1.5 rounded-lg bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark shadow-lg opacity-0 group-hover/bar:opacity-100 transition-all duration-300 pointer-events-none whitespace-nowrap translate-x-2 group-hover/bar:translate-x-0">
      <span class="text-sm font-medium text-text-light dark:text-text-dark">打赏</span>
      <!-- 小三角形指示器 -->
      <div class="absolute right-[-6px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent border-l-[6px] border-l-border-light dark:border-l-border-dark"></div>
      <div class="absolute right-[-5px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[5px] border-t-transparent border-b-[5px] border-b-transparent border-l-[5px] border-l-card-light dark:border-l-card-dark"></div>
    </div>
    <!-- 圆形背景 + 打赏图标 -->
    <div class="w-10 h-10 rounded-full bg-card-light dark:bg-card-dark backdrop-blur-sm border border-border-light dark:border-border-dark flex items-center justify-center group-hover/bar:bg-primary-light/10 dark:group-hover/bar:bg-primary-dark/10 group-hover/bar:border-primary-light/30 dark:group-hover/bar:border-primary-dark/30 transition-all duration-300 shadow-md hover:shadow-lg">
      <svg
        class="w-5 h-5 text-text-light/60 dark:text-text-dark/60 group-hover/bar:text-primary-light dark:group-hover/bar:text-primary-dark transition-all duration-300"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
        ></path>
      </svg>
    </div>
  </div>

  <!-- 订阅按钮（占位，始终显示） -->
  <div
    id="subscribe-button"
    class="flex items-center justify-end w-[180px] group/bar cursor-pointer opacity-100 transition-opacity duration-500 relative"
    aria-label="订阅"
  >
    <!-- 提示信息框 -->
    <div class="absolute right-12 px-3 py-1.5 rounded-lg bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark shadow-lg opacity-0 group-hover/bar:opacity-100 transition-all duration-300 pointer-events-none whitespace-nowrap translate-x-2 group-hover/bar:translate-x-0">
      <span class="text-sm font-medium text-text-light dark:text-text-dark">订阅</span>
      <!-- 小三角形指示器 -->
      <div class="absolute right-[-6px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent border-l-[6px] border-l-border-light dark:border-l-border-dark"></div>
      <div class="absolute right-[-5px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[5px] border-t-transparent border-b-[5px] border-b-transparent border-l-[5px] border-l-card-light dark:border-l-card-dark"></div>
    </div>
    <!-- 圆形背景 + 订阅图标 -->
    <div class="w-10 h-10 rounded-full bg-card-light dark:bg-card-dark backdrop-blur-sm border border-border-light dark:border-border-dark flex items-center justify-center group-hover/bar:bg-primary-light/10 dark:group-hover/bar:bg-primary-dark/10 group-hover/bar:border-primary-light/30 dark:group-hover/bar:border-primary-dark/30 transition-all duration-300 shadow-md hover:shadow-lg">
      <svg
        class="w-5 h-5 text-text-light/60 dark:text-text-dark/60 group-hover/bar:text-primary-light dark:group-hover/bar:text-primary-dark transition-all duration-300"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
        ></path>
      </svg>
    </div>
  </div>

  <!-- 直达评论区按钮（占位，始终显示） -->
  <div
    id="jump-to-comments"
    class="flex items-center justify-end w-[180px] group/bar cursor-pointer opacity-100 transition-opacity duration-500 relative"
    aria-label="直达评论区"
  >
    <!-- 提示信息框 -->
    <div class="absolute right-12 px-3 py-1.5 rounded-lg bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark shadow-lg opacity-0 group-hover/bar:opacity-100 transition-all duration-300 pointer-events-none whitespace-nowrap translate-x-2 group-hover/bar:translate-x-0">
      <span class="text-sm font-medium text-text-light dark:text-text-dark">直达评论区</span>
      <!-- 小三角形指示器 -->
      <div class="absolute right-[-6px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent border-l-[6px] border-l-border-light dark:border-l-border-dark"></div>
      <div class="absolute right-[-5px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[5px] border-t-transparent border-b-[5px] border-b-transparent border-l-[5px] border-l-card-light dark:border-l-card-dark"></div>
    </div>
    <!-- 圆形背景 + 评论图标 -->
    <div class="w-10 h-10 rounded-full bg-card-light dark:bg-card-dark backdrop-blur-sm border border-border-light dark:border-border-dark flex items-center justify-center group-hover/bar:bg-primary-light/10 dark:group-hover/bar:bg-primary-dark/10 group-hover/bar:border-primary-light/30 dark:group-hover/bar:border-primary-dark/30 transition-all duration-300 shadow-md hover:shadow-lg">
      <svg
        class="w-5 h-5 text-text-light/60 dark:text-text-dark/60 group-hover/bar:text-primary-light dark:group-hover/bar:text-primary-dark transition-all duration-300"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
        ></path>
      </svg>
    </div>
  </div>

  <!-- 直达底部按钮 -->
  <div
    id="jump-to-bottom"
    class="flex items-center justify-end w-[180px] group/bar cursor-pointer opacity-0 transition-opacity duration-500 relative"
    aria-label="直达底部"
  >
    <!-- 提示信息框 -->
    <div class="absolute right-12 px-3 py-1.5 rounded-lg bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark shadow-lg opacity-0 group-hover/bar:opacity-100 transition-all duration-300 pointer-events-none whitespace-nowrap translate-x-2 group-hover/bar:translate-x-0">
      <span class="text-sm font-medium text-text-light dark:text-text-dark">直达底部</span>
      <!-- 小三角形指示器 -->
      <div class="absolute right-[-6px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent border-l-[6px] border-l-border-light dark:border-l-border-dark"></div>
      <div class="absolute right-[-5px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[5px] border-t-transparent border-b-[5px] border-b-transparent border-l-[5px] border-l-card-light dark:border-l-card-dark"></div>
    </div>
    <!-- 圆形背景 + 向下箭头图标 -->
    <div class="w-10 h-10 rounded-full bg-card-light dark:bg-card-dark backdrop-blur-sm border border-border-light dark:border-border-dark flex items-center justify-center group-hover/bar:bg-primary-light/10 dark:group-hover/bar:bg-primary-dark/10 group-hover/bar:border-primary-light/30 dark:group-hover/bar:border-primary-dark/30 transition-all duration-300 shadow-md hover:shadow-lg">
      <svg
        class="w-5 h-5 text-text-light/60 dark:text-text-dark/60 group-hover/bar:text-primary-light dark:group-hover/bar:text-primary-dark transition-all duration-300"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M19 14l-7 7m0 0l-7-7m7 7V3"
        ></path>
      </svg>
    </div>
  </div>
</div>

<script is:inline>
  function initSidebarOfContents() {
    const sidebarContainer = document.getElementById('sidebar-of-contents');
    const backToTopButton = document.getElementById('back-to-top');
    const jumpToBottomButton = document.getElementById('jump-to-bottom');
    const jumpToCommentsButton = document.getElementById('jump-to-comments');
    const shareButton = document.getElementById('share-button');
    const rewardButton = document.getElementById('reward-button');
    const subscribeButton = document.getElementById('subscribe-button');

    if (!sidebarContainer || !backToTopButton || !jumpToBottomButton || !jumpToCommentsButton || !shareButton || !rewardButton || !subscribeButton) {
      return;
    }

    // 创建一个仅包含返回顶部和直达底部的容器用于显示/隐藏
    const scrollButtons = [backToTopButton, jumpToBottomButton];

    // 显示/隐藏滚动按钮（评论区按钮始终可见）
    const toggleScrollButtons = () => {
      const scrollY = window.pageYOffset;

      // 当滚动超过 200px 时显示按钮
      if (scrollY > 200) {
        scrollButtons.forEach(button => {
          button.classList.remove('opacity-0');
          button.classList.add('opacity-100');
        });
      } else {
        scrollButtons.forEach(button => {
          button.classList.remove('opacity-100');
          button.classList.add('opacity-0');
        });
      }
    };

    // 返回顶部功能
    const scrollToTop = () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth',
      });
    };

    // 直达底部功能
    const scrollToBottom = () => {
      window.scrollTo({
        top: document.body.scrollHeight,
        behavior: 'smooth',
      });
    };

    // 初始状态
    toggleScrollButtons();
    // 评论区按钮已经通过 CSS 设置为 opacity-100，不需要额外设置

    // 监听滚动事件
    let scrollTimeout;
    window.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(toggleScrollButtons, 50);
    });

    // 直达评论区功能
    const scrollToComments = () => {
      const proseContent = document.querySelector('.prose');
      if (proseContent) {
        const proseRect = proseContent.getBoundingClientRect();
        const scrollTop = window.pageYOffset + proseRect.bottom - window.innerHeight + 650;
        window.scrollTo({
          top: scrollTop,
          behavior: 'smooth',
        });
      }
    };

    // 监听点击事件
    backToTopButton.addEventListener('click', scrollToTop);
    jumpToBottomButton.addEventListener('click', scrollToBottom);
    jumpToCommentsButton.addEventListener('click', scrollToComments);
    shareButton.addEventListener('click', () => {});
    rewardButton.addEventListener('click', () => {});
    subscribeButton.addEventListener('click', () => {});
  }

  // 页面加载时初始化
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(initSidebarOfContents, 100);
    });
  } else {
    setTimeout(initSidebarOfContents, 100);
  }

  // 监听 Astro 页面转换
  document.addEventListener('astro:after-swap', () => {
    setTimeout(initSidebarOfContents, 100);
  });
</script>
