---
---

<!-- ä¾§è¾¹åŠŸèƒ½å›¾æ ‡ç»„ - ä¸ç›®å½•æ°´å¹³å¯¹ç§° -->
<div
  id="sidebar-of-contents"
  class="hidden xl:flex fixed top-1/2 -translate-y-1/2 left-[max(4rem,calc((100vw-1340px)/2-2rem))] z-40 flex-col gap-4"
>
  <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
  <div
    id="back-to-top"
    class="flex items-center justify-end w-[180px] group/bar cursor-pointer opacity-0 transition-opacity duration-500 relative"
    aria-label="è¿”å›é¡¶éƒ¨"
  >
    <!-- å·¦ä¾§æç¤ºä¿¡æ¯æ¡†ï¼ˆåœ¨æŒ‰é’®å·¦è¾¹ï¼‰ -->
    <div class="absolute right-12 px-3 py-1.5 rounded-lg bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark shadow-lg opacity-0 group-hover/bar:opacity-100 transition-all duration-300 pointer-events-none whitespace-nowrap translate-x-2 group-hover/bar:translate-x-0">
      <span class="text-sm font-medium text-text-light dark:text-text-dark">è¿”å›é¡¶éƒ¨</span>
      <!-- å°ä¸‰è§’å½¢æŒ‡ç¤ºå™¨ - æŒ‡å‘å³ä¾§ -->
      <div class="absolute right-[-6px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent border-l-[6px] border-l-border-light dark:border-l-border-dark"></div>
      <div class="absolute right-[-5px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[5px] border-t-transparent border-b-[5px] border-b-transparent border-l-[5px] border-l-card-light dark:border-l-card-dark"></div>
    </div>
    <!-- åœ†å½¢èƒŒæ™¯ + å‘ä¸Šç®­å¤´å›¾æ ‡ -->
    <div class="w-10 h-10 rounded-full bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark flex items-center justify-center group-hover/bar:bg-primary-light/10 dark:group-hover/bar:bg-primary-dark/10 group-hover/bar:border-primary-light/40 dark:group-hover/bar:border-primary-dark/40 transition-all duration-300 shadow-md hover:shadow-lg">
      <svg
        class="w-5 h-5 text-text-light/60 dark:text-text-dark/60 group-hover/bar:text-primary-light dark:group-hover/bar:text-primary-dark transition-all duration-300"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M5 10l7-7m0 0l7 7m-7-7v18"
        ></path>
      </svg>
    </div>
  </div>

  <!-- åˆ†äº«æŒ‰é’®ï¼ˆå ä½ï¼Œå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
  <div
    id="share-button"
    class="flex items-center justify-end w-[180px] group/bar cursor-pointer opacity-100 transition-opacity duration-500 relative"
    aria-label="åˆ†äº«"
  >
    <!-- åˆ†äº«é¢æ¿ - hoveræ—¶ç›´æ¥æ˜¾ç¤º -->
    <div id="share-panel" class="absolute right-12 w-[320px] p-4 rounded-xl bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark shadow-2xl opacity-0 scale-95 pointer-events-none group-hover/bar:opacity-100 group-hover/bar:scale-100 group-hover/bar:pointer-events-auto transition-all duration-300 origin-right z-10">
      <div class="flex flex-col gap-3">
        <!-- æµ·æŠ¥é¢„è§ˆåŒºåŸŸ -->
        <div id="poster-preview" class="w-full rounded-lg overflow-hidden border border-border-light dark:border-border-dark">
          <img id="poster-image" src="" alt="æµ·æŠ¥é¢„è§ˆ" class="w-full h-auto" />
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="flex flex-col gap-2">
          <button id="copy-link-btn" class="w-full px-3 py-2 bg-bg-light dark:bg-bg-dark border border-border-light dark:border-border-dark text-text-light dark:text-text-dark rounded-lg hover:bg-primary-light/10 dark:hover:bg-primary-dark/10 transition-all duration-300 text-sm font-medium">
            å¤åˆ¶é“¾æ¥
          </button>
          <button id="download-poster-btn" class="w-full px-3 py-2 bg-primary-light dark:bg-primary-dark text-white rounded-lg hover:opacity-80 transition-all duration-300 text-sm font-medium">
            ä¸‹è½½æµ·æŠ¥
          </button>
        </div>
      </div>
      <!-- å°ä¸‰è§’å½¢æŒ‡ç¤ºå™¨ - æŒ‡å‘å³ä¾§æŒ‰é’® -->
      <div class="absolute right-[-6px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent border-l-[6px] border-l-border-light dark:border-l-border-dark"></div>
      <div class="absolute right-[-5px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[5px] border-t-transparent border-b-[5px] border-b-transparent border-l-[5px] border-l-card-light dark:border-l-card-dark"></div>
    </div>

    <!-- åœ†å½¢èƒŒæ™¯ + åˆ†äº«å›¾æ ‡ -->
    <div class="w-10 h-10 rounded-full bg-card-light dark:bg-card-dark backdrop-blur-sm border border-border-light dark:border-border-dark flex items-center justify-center group-hover/bar:bg-primary-light/10 dark:group-hover/bar:bg-primary-dark/10 group-hover/bar:border-primary-light/30 dark:group-hover/bar:border-primary-dark/30 transition-all duration-300 shadow-md hover:shadow-lg">
      <svg
        class="w-5 h-5 text-text-light/60 dark:text-text-dark/60 group-hover/bar:text-primary-light dark:group-hover/bar:text-primary-dark transition-all duration-300"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"
        ></path>
      </svg>
    </div>
  </div>

  <!-- æ‰“èµæŒ‰é’®ï¼ˆå ä½ï¼Œå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
  <div
    id="reward-button"
    class="flex items-center justify-end w-[180px] group/bar cursor-pointer opacity-100 transition-opacity duration-500 relative"
    aria-label="æ‰“èµ"
  >
    <!-- æ‰“èµé¢æ¿ - hoveræ—¶ç›´æ¥æ˜¾ç¤º -->
    <div id="reward-large-panel" class="absolute right-12 w-[300px] p-4 rounded-xl bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark shadow-2xl opacity-0 scale-95 pointer-events-none group-hover/bar:opacity-100 group-hover/bar:scale-100 group-hover/bar:pointer-events-auto transition-all duration-300 origin-right z-10">
      <div class="flex flex-col items-center gap-3">
        <h3 class="text-base font-semibold text-text-light dark:text-text-dark">æ„Ÿè°¢æ‰“èµ</h3>
        <!-- ä¸¤ä¸ªäºŒç»´ç å·¦å³æ’åˆ— -->
        <div class="flex gap-3 items-start">
          <!-- å¾®ä¿¡èµèµç  -->
          <div class="flex flex-col items-center gap-2">
            <div class="w-32 h-32 rounded-lg overflow-hidden bg-bg-light dark:bg-bg-dark border border-border-light dark:border-border-dark">
              <img
                src="/src/assets/wechatGood.webp"
                alt="å¾®ä¿¡èµèµç "
                class="w-full h-full object-cover"
              />
            </div>
            <span class="text-xs text-text-light/60 dark:text-text-dark/60">å¾®ä¿¡</span>
          </div>
          <!-- æ”¯ä»˜å®èµèµç  -->
          <div class="flex flex-col items-center gap-2">
            <div class="w-32 h-32 rounded-lg overflow-hidden bg-bg-light dark:bg-bg-dark border border-border-light dark:border-border-dark">
              <img
                src="/src/assets/alipayGood.webp"
                alt="æ”¯ä»˜å®èµèµç "
                class="w-full h-full object-cover"
              />
            </div>
            <span class="text-xs text-text-light/60 dark:text-text-dark/60">æ”¯ä»˜å®</span>
          </div>
        </div>
        <p class="text-sm text-text-light/70 dark:text-text-dark/70 text-center">æ‰«ç æ”¯æŒä½œè€…</p>
      </div>
      <!-- å°ä¸‰è§’å½¢æŒ‡ç¤ºå™¨ - æŒ‡å‘å³ä¾§æŒ‰é’® -->
      <div class="absolute right-[-6px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent border-l-[6px] border-l-border-light dark:border-l-border-dark"></div>
      <div class="absolute right-[-5px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[5px] border-t-transparent border-b-[5px] border-b-transparent border-l-[5px] border-l-card-light dark:border-l-card-dark"></div>
    </div>

    <!-- åœ†å½¢èƒŒæ™¯ + æ‰“èµå›¾æ ‡ -->
    <div class="w-10 h-10 rounded-full bg-card-light dark:bg-card-dark backdrop-blur-sm border border-border-light dark:border-border-dark flex items-center justify-center group-hover/bar:bg-primary-light/10 dark:group-hover/bar:bg-primary-dark/10 group-hover/bar:border-primary-light/30 dark:group-hover/bar:border-primary-dark/30 transition-all duration-300 shadow-md hover:shadow-lg">
      <svg
        class="w-5 h-5 text-text-light/60 dark:text-text-dark/60 group-hover/bar:text-primary-light dark:group-hover/bar:text-primary-dark transition-all duration-300"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
        ></path>
      </svg>
    </div>
  </div>

  <!-- è®¢é˜…æŒ‰é’®ï¼ˆå ä½ï¼Œå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
  <div
    id="subscribe-button"
    class="flex items-center justify-end w-[180px] group/bar cursor-pointer opacity-100 transition-opacity duration-500 relative"
    aria-label="è®¢é˜…"
  >
    <!-- è®¢é˜…é¢æ¿ - hoveræ—¶ç›´æ¥æ˜¾ç¤º -->
    <div id="subscribe-panel" class="absolute right-12 w-[300px] p-5 rounded-xl bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark shadow-2xl opacity-0 scale-95 pointer-events-none group-hover/bar:opacity-100 group-hover/bar:scale-100 group-hover/bar:pointer-events-auto transition-all duration-300 origin-right z-10">
      <div class="flex flex-col gap-4">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <div class="flex items-center gap-2.5">
          <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-[#f26522]/20 to-[#f26522]/5 flex items-center justify-center">
            <svg class="w-5 h-5 text-[#f26522]" fill="currentColor" viewBox="0 0 24 24">
              <path d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248S0 22.546 0 20.752s1.456-3.248 3.252-3.248 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-8.18v4.831c10.555.062 19.121 8.614 19.184 19.17h4.817c-.063-13.215-10.782-23.93-24.001-24.001z"></path>
            </svg>
          </div>
          <div class="flex-1">
            <h3 class="text-sm font-bold text-text-light dark:text-text-dark">RSS è®¢é˜…</h3>
            <p class="text-[11px] text-text-light/50 dark:text-text-dark/50">è·å–æœ€æ–°æ–‡ç« æ¨é€</p>
          </div>
        </div>

        <!-- RSSé“¾æ¥æ˜¾ç¤ºåŒºåŸŸ -->
        <div class="relative group/link">
          <div class="px-3 py-2.5 bg-background-light dark:bg-background-dark border border-border-light dark:border-border-dark rounded-lg transition-all duration-200 group-hover/link:border-[#f26522]/30">
            <code class="text-[10px] font-mono text-text-light/60 dark:text-text-dark/60 select-all break-all leading-relaxed">https://log.1k.ink/rss.xml</code>
          </div>
          <!-- è£…é¥°æ€§æ¸å˜è¾¹æ¡†æ•ˆæœ -->
          <div class="absolute inset-0 rounded-lg bg-gradient-to-r from-[#f26522]/0 via-[#f26522]/5 to-[#f26522]/0 opacity-0 group-hover/link:opacity-100 transition-opacity duration-300 pointer-events-none"></div>
        </div>

        <!-- å¤åˆ¶æŒ‰é’® -->
        <button
          id="rss-copy-btn"
          data-rss-url="https://log.1k.ink/rss.xml"
          class="w-full px-3 py-2.5 bg-primary-light dark:bg-primary-dark text-white dark:text-black rounded-lg hover:opacity-90 active:scale-[0.98] transition-all duration-200 text-xs font-semibold shadow-sm hover:shadow-md flex items-center justify-center gap-2 group/btn"
        >
          <svg class="w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
          </svg>
          <span id="rss-copy-text">å¤åˆ¶é“¾æ¥</span>
        </button>

        <!-- æ”¯æŒçš„é˜…è¯»å™¨æç¤º -->
        <div class="pt-2 border-t border-border-light/50 dark:border-border-dark/50">
          <p class="text-[10px] text-text-light/40 dark:text-text-dark/40 text-center leading-relaxed">
            æ”¯æŒ Feedlyã€Inoreaderã€Reeder ç­‰
          </p>
        </div>
      </div>
      <!-- å°ä¸‰è§’å½¢æŒ‡ç¤ºå™¨ - æŒ‡å‘å³ä¾§æŒ‰é’® -->
      <div class="absolute right-[-6px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent border-l-[6px] border-l-border-light dark:border-l-border-dark"></div>
      <div class="absolute right-[-5px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[5px] border-t-transparent border-b-[5px] border-b-transparent border-l-[5px] border-l-card-light dark:border-l-card-dark"></div>
    </div>

    <!-- åœ†å½¢èƒŒæ™¯ + è®¢é˜…å›¾æ ‡ -->
    <div class="w-10 h-10 rounded-full bg-card-light dark:bg-card-dark backdrop-blur-sm border border-border-light dark:border-border-dark flex items-center justify-center group-hover/bar:bg-primary-light/10 dark:group-hover/bar:bg-primary-dark/10 group-hover/bar:border-primary-light/30 dark:group-hover/bar:border-primary-dark/30 transition-all duration-300 shadow-md hover:shadow-lg">
      <svg
        class="w-5 h-5 text-text-light/60 dark:text-text-dark/60 group-hover/bar:text-primary-light dark:group-hover/bar:text-primary-dark transition-all duration-300"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
        ></path>
      </svg>
    </div>
  </div>

  <!-- ç›´è¾¾è¯„è®ºåŒºæŒ‰é’®ï¼ˆå ä½ï¼Œå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
  <div
    id="jump-to-comments"
    class="flex items-center justify-end w-[180px] group/bar cursor-pointer opacity-100 transition-opacity duration-500 relative"
    aria-label="ç›´è¾¾è¯„è®ºåŒº"
  >
    <!-- å·¦ä¾§æç¤ºä¿¡æ¯æ¡†ï¼ˆåœ¨æŒ‰é’®å·¦è¾¹ï¼‰ -->
    <div class="absolute right-12 px-3 py-1.5 rounded-lg bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark shadow-lg opacity-0 group-hover/bar:opacity-100 transition-all duration-300 pointer-events-none whitespace-nowrap translate-x-2 group-hover/bar:translate-x-0">
      <span class="text-sm font-medium text-text-light dark:text-text-dark">ç›´è¾¾è¯„è®ºåŒº</span>
      <!-- å°ä¸‰è§’å½¢æŒ‡ç¤ºå™¨ - æŒ‡å‘å³ä¾§ -->
      <div class="absolute right-[-6px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent border-l-[6px] border-l-border-light dark:border-l-border-dark"></div>
      <div class="absolute right-[-5px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[5px] border-t-transparent border-b-[5px] border-b-transparent border-l-[5px] border-l-card-light dark:border-l-card-dark"></div>
    </div>
    <!-- åœ†å½¢èƒŒæ™¯ + è¯„è®ºå›¾æ ‡ -->
    <div class="w-10 h-10 rounded-full bg-card-light dark:bg-card-dark backdrop-blur-sm border border-border-light dark:border-border-dark flex items-center justify-center group-hover/bar:bg-primary-light/10 dark:group-hover/bar:bg-primary-dark/10 group-hover/bar:border-primary-light/30 dark:group-hover/bar:border-primary-dark/30 transition-all duration-300 shadow-md hover:shadow-lg">
      <svg
        class="w-5 h-5 text-text-light/60 dark:text-text-dark/60 group-hover/bar:text-primary-light dark:group-hover/bar:text-primary-dark transition-all duration-300"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
        ></path>
      </svg>
    </div>
  </div>

  <!-- ç›´è¾¾åº•éƒ¨æŒ‰é’® -->
  <div
    id="jump-to-bottom"
    class="flex items-center justify-end w-[180px] group/bar cursor-pointer opacity-0 transition-opacity duration-500 relative"
    aria-label="ç›´è¾¾åº•éƒ¨"
  >
    <!-- å·¦ä¾§æç¤ºä¿¡æ¯æ¡†ï¼ˆåœ¨æŒ‰é’®å·¦è¾¹ï¼‰ -->
    <div class="absolute right-12 px-3 py-1.5 rounded-lg bg-card-light dark:bg-card-dark backdrop-blur-md border border-border-light dark:border-border-dark shadow-lg opacity-0 group-hover/bar:opacity-100 transition-all duration-300 pointer-events-none whitespace-nowrap translate-x-2 group-hover/bar:translate-x-0">
      <span class="text-sm font-medium text-text-light dark:text-text-dark">ç›´è¾¾åº•éƒ¨</span>
      <!-- å°ä¸‰è§’å½¢æŒ‡ç¤ºå™¨ - æŒ‡å‘å³ä¾§ -->
      <div class="absolute right-[-6px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[6px] border-t-transparent border-b-[6px] border-b-transparent border-l-[6px] border-l-border-light dark:border-l-border-dark"></div>
      <div class="absolute right-[-5px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-[5px] border-t-transparent border-b-[5px] border-b-transparent border-l-[5px] border-l-card-light dark:border-l-card-dark"></div>
    </div>
    <!-- åœ†å½¢èƒŒæ™¯ + å‘ä¸‹ç®­å¤´å›¾æ ‡ -->
    <div class="w-10 h-10 rounded-full bg-card-light dark:bg-card-dark backdrop-blur-sm border border-border-light dark:border-border-dark flex items-center justify-center group-hover/bar:bg-primary-light/10 dark:group-hover/bar:bg-primary-dark/10 group-hover/bar:border-primary-light/30 dark:group-hover/bar:border-primary-dark/30 transition-all duration-300 shadow-md hover:shadow-lg">
      <svg
        class="w-5 h-5 text-text-light/60 dark:text-text-dark/60 group-hover/bar:text-primary-light dark:group-hover/bar:text-primary-dark transition-all duration-300"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M19 14l-7 7m0 0l-7-7m7 7V3"
        ></path>
      </svg>
    </div>
  </div>
</div>

<script>
  import QRCode from 'qrcode';

  function initSidebarOfContents() {
    const sidebarContainer = document.getElementById('sidebar-of-contents');
    const backToTopButton = document.getElementById('back-to-top');
    const jumpToBottomButton = document.getElementById('jump-to-bottom');
    const jumpToCommentsButton = document.getElementById('jump-to-comments');

    if (!sidebarContainer || !backToTopButton || !jumpToBottomButton || !jumpToCommentsButton) {
      return;
    }

    // åˆ›å»ºä¸€ä¸ªä»…åŒ…å«è¿”å›é¡¶éƒ¨å’Œç›´è¾¾åº•éƒ¨çš„å®¹å™¨ç”¨äºæ˜¾ç¤º/éšè—
    const scrollButtons = [backToTopButton, jumpToBottomButton];

    // æ˜¾ç¤º/éšè—æ»šåŠ¨æŒ‰é’®ï¼ˆè¯„è®ºåŒºæŒ‰é’®å§‹ç»ˆå¯è§ï¼‰
    const toggleScrollButtons = () => {
      const scrollY = window.pageYOffset;

      // å½“æ»šåŠ¨è¶…è¿‡ 200px æ—¶æ˜¾ç¤ºæŒ‰é’®
      if (scrollY > 200) {
        scrollButtons.forEach(button => {
          button.classList.remove('opacity-0');
          button.classList.add('opacity-100');
        });
      } else {
        scrollButtons.forEach(button => {
          button.classList.remove('opacity-100');
          button.classList.add('opacity-0');
        });
      }
    };

    // è¿”å›é¡¶éƒ¨åŠŸèƒ½
    const scrollToTop = () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth',
      });
    };

    // ç›´è¾¾åº•éƒ¨åŠŸèƒ½
    const scrollToBottom = () => {
      window.scrollTo({
        top: document.body.scrollHeight,
        behavior: 'smooth',
      });
    };

    // åˆå§‹çŠ¶æ€
    toggleScrollButtons();
    // è¯„è®ºåŒºæŒ‰é’®å·²ç»é€šè¿‡ CSS è®¾ç½®ä¸º opacity-100ï¼Œä¸éœ€è¦é¢å¤–è®¾ç½®

    // ç›‘å¬æ»šåŠ¨äº‹ä»¶
    let scrollTimeout: ReturnType<typeof setTimeout> | undefined;
    window.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(toggleScrollButtons, 50);
    });

    // ç›´è¾¾è¯„è®ºåŒºåŠŸèƒ½
    const scrollToComments = () => {
      const proseContent = document.querySelector('.prose');
      if (proseContent) {
        const proseRect = proseContent.getBoundingClientRect();
        const scrollTop = window.pageYOffset + proseRect.bottom - window.innerHeight + 650;
        window.scrollTo({
          top: scrollTop,
          behavior: 'smooth',
        });
      }
    };

    // ç”Ÿæˆæµ·æŠ¥åŠŸèƒ½
    const generatePoster = async () => {
      const downloadBtn = document.getElementById('download-poster-btn') as HTMLButtonElement | null;
      const posterPreview = document.getElementById('poster-preview');
      const posterImage = document.getElementById('poster-image') as HTMLImageElement | null;

      if (!downloadBtn || !posterPreview || !posterImage) return;

      try {
        // è·å–å½“å‰é¡µé¢ä¿¡æ¯
        const pageTitle = document.querySelector('h1')?.textContent || document.title;
        const pageDescription = (document.querySelector('meta[name="description"]') as HTMLMetaElement)?.content || 'åˆ†äº«è¿™ç¯‡æ–‡ç« ';
        const pageUrl = window.location.href;

        // è·å– heroImageï¼ˆä» background-image æ ·å¼ä¸­æå–ï¼‰
        let heroImageSrc = '';

        // å°è¯•å¤šç§é€‰æ‹©å™¨
        const selectors = [
          'article div.bg-cover.bg-center',
          'article div[class*="bg-cover"]',
          'div.bg-cover.bg-center',
          'article > div > div.bg-cover'
        ];

        for (const selector of selectors) {
          const heroImageDiv = document.querySelector(selector);
          if (heroImageDiv) {
            const bgImage = window.getComputedStyle(heroImageDiv).backgroundImage;
            console.log(`é€‰æ‹©å™¨ "${selector}" æ‰¾åˆ°å…ƒç´ ï¼ŒbackgroundImage:`, bgImage);

            if (bgImage && bgImage !== 'none') {
              const urlMatch = bgImage.match(/url\(['"]?([^'"]+)['"]?\)/);
              if (urlMatch) {
                heroImageSrc = urlMatch[1];
                console.log('æˆåŠŸæå– heroImage:', heroImageSrc);
                break;
              }
            }
          }
        }

        if (!heroImageSrc) {
          console.log('æœªæ‰¾åˆ° heroImageï¼Œå°†ç”Ÿæˆæ— å›¾ç‰‡ç‰ˆæœ¬æµ·æŠ¥');
        }

        // åˆ›å»º Canvas - å›ºå®šå°ºå¯¸ 750x1000
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        if (!ctx) {
          throw new Error('æ— æ³•è·å– Canvas ä¸Šä¸‹æ–‡');
        }
        const posterWidth = 750;
        const posterHeight = 1000;
        canvas.width = posterWidth;
        canvas.height = posterHeight;

        // èƒŒæ™¯è‰²
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, posterWidth, posterHeight);

        // ç»˜åˆ¶ heroImageï¼ˆå¦‚æœå­˜åœ¨ï¼‰- ä½¿ç”¨æºçŸ©å½¢è£å‰ªï¼Œé¿å… clip
        if (heroImageSrc) {
          try {
            const img = new Image();
            img.crossOrigin = 'anonymous';
            await new Promise((resolve, reject) => {
              img.onload = resolve;
              img.onerror = reject;
              img.src = heroImageSrc;
            });

            // ç›®æ ‡åŒºåŸŸ - å æ®45%çš„é«˜åº¦
            const targetWidth = posterWidth;
            const targetHeight = 450; // 45% of 1000px

            const imgRatio = img.width / img.height;
            const targetRatio = targetWidth / targetHeight;

            let sx, sy, sWidth, sHeight;

            if (imgRatio > targetRatio) {
              // å›¾ç‰‡æ›´å®½ï¼Œè£å‰ªå·¦å³ä¸¤ä¾§
              sHeight = img.height;
              sWidth = sHeight * targetRatio;
              sx = (img.width - sWidth) / 2;
              sy = 0;
            } else {
              // å›¾ç‰‡æ›´é«˜ï¼Œè£å‰ªä¸Šä¸‹ä¸¤ä¾§
              sWidth = img.width;
              sHeight = sWidth / targetRatio;
              sx = 0;
              sy = (img.height - sHeight) / 2;
            }

            // ä½¿ç”¨ drawImage çš„ 9 å‚æ•°ç‰ˆæœ¬ï¼šæºçŸ©å½¢ + ç›®æ ‡çŸ©å½¢
            ctx.drawImage(img, sx, sy, sWidth, sHeight, 0, 0, targetWidth, targetHeight);
          } catch (err) {
            console.log('æ— æ³•åŠ è½½å›¾ç‰‡ï¼Œè·³è¿‡');
          }
        }

        // ç»˜åˆ¶æ ‡é¢˜ - å·¦å¯¹é½ï¼Œä½¿ç”¨ä¸æè¿°ç›¸åŒçš„maxWidth
        ctx.fillStyle = '#1a1a1a';
        ctx.font = 'bold 48px sans-serif';
        ctx.textAlign = 'left'; // æ”¹ä¸ºå·¦å¯¹é½
        ctx.textBaseline = 'top';
        const titleY = heroImageSrc ? 490 : 80; // å›¾ç‰‡åç•™40pxè¾¹è·ï¼ˆ450+40ï¼‰
        const contentMaxWidth = posterWidth - 80; // 670pxï¼Œä¸åˆ†éš”çº¿å’Œæè¿°å®½åº¦ä¸€è‡´
        const titleLines = wrapText(ctx, pageTitle, 40, titleY, contentMaxWidth, 60);

        // ç»˜åˆ¶æè¿° - å·¦å¯¹é½ï¼ŒmaxWidthä¸åˆ†éš”çº¿å®½åº¦ä¸€è‡´
        ctx.fillStyle = '#666666';
        ctx.font = '30px sans-serif';
        ctx.textAlign = 'left'; // æ”¹ä¸ºå·¦å¯¹é½
        const descY = titleY + (titleLines * 60) + 20; // æ ¹æ®æ ‡é¢˜å®é™…è¡Œæ•°è®¡ç®—ä½ç½®
        wrapText(ctx, pageDescription, 40, descY, contentMaxWidth, 40);

        // ç»˜åˆ¶åˆ†éš”çº¿ - åœ¨äºŒç»´ç åŒºåŸŸä¸Šæ–¹ï¼Œä¸æ ‡é¢˜å®½åº¦ä¸€è‡´
        ctx.strokeStyle = '#e0e0e0';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(40, 800); // ä»å·¦è¾¹è·40pxå¼€å§‹ï¼Œä¸æ ‡é¢˜å¯¹é½
        ctx.lineTo(posterWidth - 40, 800); // åˆ°å³è¾¹è·40pxç»“æŸï¼Œä¸æ ‡é¢˜å¯¹é½
        ctx.stroke();

        // åŠ è½½å¹¶ç»˜åˆ¶åœ†å½¢å¤´åƒå’Œä½œè€…ä¿¡æ¯
        const avatarUrl = 'https://thirdqq.qlogo.cn/g?b=sdk&k=h55tiaaAAKPaziaDJ8NNkIzA&s=640&t=1627665755';
        const avatarSize = 110; // è¿›ä¸€æ­¥å¢å¤§å¤´åƒå°ºå¯¸
        const avatarX = 40; // å·¦å¯¹é½æ ‡é¢˜ä½ç½®
        const avatarY = 890; // å‚ç›´å±…ä¸­äºäºŒç»´ç åŒºåŸŸ

        // å°è¯•åŠ è½½å¤´åƒï¼ˆå¯é€‰ï¼‰
        try {
          // ä½¿ç”¨ fetch é€šè¿‡ CORS ä»£ç†è·å–å›¾ç‰‡
          const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(avatarUrl)}`);
          const blob = await response.blob();
          const objectUrl = URL.createObjectURL(blob);

          const avatarImg = new Image();
          await new Promise((resolve, reject) => {
            avatarImg.onload = resolve;
            avatarImg.onerror = reject;
            avatarImg.src = objectUrl;
          });

          // ç»˜åˆ¶åœ†å½¢å¤´åƒï¼ˆä½¿ç”¨ clipï¼‰
          ctx.save();
          ctx.beginPath();
          ctx.arc(avatarX + avatarSize / 2, avatarY, avatarSize / 2, 0, Math.PI * 2);
          ctx.closePath();
          ctx.clip();
          ctx.drawImage(avatarImg, avatarX, avatarY - avatarSize / 2, avatarSize, avatarSize);
          ctx.restore();

          // æ¸…ç† object URL
          URL.revokeObjectURL(objectUrl);
        } catch (err) {
          console.log('å¤´åƒåŠ è½½å¤±è´¥ï¼Œå°†åªæ˜¾ç¤ºæ–‡å­—', err);
        }

        // ç»˜åˆ¶ä½œè€…åç§° "æ³¢ç½—æ­Œ"ï¼ˆæ— è®ºå¤´åƒæ˜¯å¦åŠ è½½æˆåŠŸéƒ½ç»˜åˆ¶ï¼‰
        ctx.fillStyle = '#1a1a1a';
        ctx.font = 'bold 36px sans-serif'; // è¿›ä¸€æ­¥å¢å¤§å­—ä½“
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';
        ctx.fillText('æ³¢ç½—æ­Œ', avatarX + avatarSize + 20, avatarY - 22);

        // ç»˜åˆ¶ç­¾å "ä¸€çŸ¥åŠè§£ï¼Œä»ä¸€è€Œç»ˆ"
        ctx.fillStyle = '#666666';
        ctx.font = '24px sans-serif'; // è¿›ä¸€æ­¥å¢å¤§å­—ä½“
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';
        ctx.fillText('ä¸€çŸ¥åŠè§£ï¼Œä»ä¸€è€Œç»ˆ', avatarX + avatarSize + 20, avatarY + 22);

        // ç”ŸæˆäºŒç»´ç ï¼ˆä½¿ç”¨æœ¬åœ° qrcode åº“ï¼‰
        const qrSize = 110; // è°ƒæ•´ä¸º110px

        try {
          // ä½¿ç”¨æœ¬åœ° qrcode åº“ç”ŸæˆäºŒç»´ç 
          const qrDataUrl = await QRCode.toDataURL(pageUrl, {
            width: qrSize,
            margin: 1,
            color: {
              dark: '#000000',
              light: '#FFFFFF'
            }
          });

          // å°†äºŒç»´ç ç»˜åˆ¶åˆ° canvas
          const qrImg = new Image();
          await new Promise((resolve, reject) => {
            qrImg.onload = resolve;
            qrImg.onerror = reject;
            qrImg.src = qrDataUrl;
          });

          const qrX = posterWidth - 180; // é å³æ”¾ç½®ï¼Œç•™å‡ºå·¦ä¾§ç©ºé—´ç»™å¤´åƒå’Œæ–‡å­—
          const qrY = 825; // åˆ†éš”çº¿ä¸‹æ–¹25px
          ctx.drawImage(qrImg, qrX, qrY, qrSize, qrSize);

          // äºŒç»´ç ä¸‹æ–¹æ–‡å­—
          ctx.fillStyle = '#999999';
          ctx.font = '18px sans-serif';
          ctx.textAlign = 'center';
          ctx.fillText('æ‰«ç æŸ¥çœ‹åŸæ–‡', qrX + qrSize / 2, 960); // æ–‡å­—ä½ç½®ç›¸åº”è°ƒæ•´
        } catch (err) {
          console.log('äºŒç»´ç ç”Ÿæˆå¤±è´¥', err);
        }

        // å°† Canvas è½¬æ¢ä¸ºå›¾ç‰‡
        const dataUrl = canvas.toDataURL('image/png');
        posterImage.src = dataUrl;

        // ä¿å­˜ dataUrl ä¾›ä¸‹è½½ä½¿ç”¨
        downloadBtn.dataset.posterUrl = dataUrl;
      } catch (error) {
        console.error('ç”Ÿæˆæµ·æŠ¥å¤±è´¥:', error);
      }
    };

    // æ–‡å­—æ¢è¡Œè¾…åŠ©å‡½æ•° - è¿”å›å®é™…ç»˜åˆ¶çš„è¡Œæ•°
    function wrapText(ctx: CanvasRenderingContext2D, text: string, x: number, y: number, maxWidth: number, lineHeight: number): number {
      const lines = [];
      let currentLine = '';
      const maxLines = 3;

      // ç¬¬ä¸€æ­¥ï¼šå°†æ–‡æœ¬åˆ†å‰²æˆè¡Œ
      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const testLine = currentLine + char;
        const testWidth = ctx.measureText(testLine).width;

        if (testWidth > maxWidth && currentLine.length > 0) {
          // å½“å‰è¡Œå·²æ»¡ï¼Œä¿å­˜å½“å‰è¡Œï¼Œå¼€å§‹æ–°è¡Œ
          lines.push(currentLine);
          currentLine = char; // å½“å‰å­—ç¬¦ä½œä¸ºæ–°è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦
        } else {
          // ç»§ç»­æ·»åŠ åˆ°å½“å‰è¡Œ
          currentLine = testLine;
        }
      }

      // æ·»åŠ æœ€åä¸€è¡Œ
      if (currentLine.length > 0) {
        lines.push(currentLine);
      }

      // ç¬¬äºŒæ­¥ï¼šç»˜åˆ¶è¡Œï¼ˆæœ€å¤š3è¡Œï¼‰
      for (let i = 0; i < Math.min(lines.length, maxLines); i++) {
        let lineText = lines[i];

        // å¦‚æœæ˜¯ç¬¬3è¡Œä¸”è¿˜æœ‰æ›´å¤šå†…å®¹ï¼Œæ·»åŠ çœç•¥å·
        if (i === maxLines - 1 && lines.length > maxLines) {
          const ellipsis = '...';
          // ç¡®ä¿çœç•¥å·èƒ½æ”¾å¾—ä¸‹
          while (ctx.measureText(lineText + ellipsis).width > maxWidth && lineText.length > 1) {
            lineText = lineText.slice(0, -1);
          }
          lineText += ellipsis;
        }

        ctx.fillText(lineText, x, y + i * lineHeight);
      }

      // è¿”å›å®é™…ç»˜åˆ¶çš„è¡Œæ•°
      return Math.min(lines.length, maxLines);
    }

    // ä¸‹è½½æµ·æŠ¥
    const downloadPoster = () => {
      const downloadBtn = document.getElementById('download-poster-btn') as HTMLButtonElement | null;
      if (!downloadBtn || !downloadBtn.dataset.posterUrl) return;

      const originalText = downloadBtn.textContent;

      try {
        const link = document.createElement('a');
        link.download = 'poster.png';
        link.href = downloadBtn.dataset.posterUrl;
        link.click();

        // ä¸‹è½½æˆåŠŸåé¦ˆ
        downloadBtn.textContent = 'ğŸ˜‹ä¸‹è½½æˆåŠŸ';

        setTimeout(() => {
          downloadBtn.textContent = originalText || 'ä¸‹è½½æµ·æŠ¥';
        }, 2000);
      } catch (error) {
        console.error('ä¸‹è½½å¤±è´¥:', error);

        // ä¸‹è½½å¤±è´¥åé¦ˆ
        downloadBtn.textContent = 'âŒä¸‹è½½å¤±è´¥';

        setTimeout(() => {
          downloadBtn.textContent = originalText || 'ä¸‹è½½æµ·æŠ¥';
        }, 2000);
      }
    };

    // ç›‘å¬ç‚¹å‡»äº‹ä»¶
    backToTopButton.addEventListener('click', scrollToTop);
    jumpToBottomButton.addEventListener('click', scrollToBottom);
    jumpToCommentsButton.addEventListener('click', scrollToComments);

    // å¤åˆ¶é“¾æ¥åŠŸèƒ½
    const copyLink = () => {
      const copyLinkBtn = document.getElementById('copy-link-btn') as HTMLButtonElement | null;
      if (!copyLinkBtn) return;

      const pageUrl = window.location.href;
      const originalText = copyLinkBtn.textContent;

      navigator.clipboard.writeText(pageUrl).then(() => {
        // å¤åˆ¶æˆåŠŸåé¦ˆ
        copyLinkBtn.textContent = 'ğŸ¥³å·²å¤åˆ¶';

        setTimeout(() => {
          copyLinkBtn.textContent = originalText || 'å¤åˆ¶é“¾æ¥';
        }, 2000);
      }).catch((err) => {
        console.error('å¤åˆ¶å¤±è´¥:', err);
        copyLinkBtn.textContent = 'å¤åˆ¶å¤±è´¥';
        setTimeout(() => {
          copyLinkBtn.textContent = originalText || 'å¤åˆ¶é“¾æ¥';
        }, 2000);
      });
    };

    // ä¸‹è½½æµ·æŠ¥æŒ‰é’®
    const downloadPosterBtn = document.getElementById('download-poster-btn');
    if (downloadPosterBtn) {
      downloadPosterBtn.addEventListener('click', downloadPoster);
    }

    // å¤åˆ¶é“¾æ¥æŒ‰é’®
    const copyLinkBtn = document.getElementById('copy-link-btn');
    if (copyLinkBtn) {
      copyLinkBtn.addEventListener('click', copyLink);
    }

    // RSSå¤åˆ¶åŠŸèƒ½
    const copyRssLink = () => {
      const rssCopyBtn = document.getElementById('rss-copy-btn') as HTMLButtonElement | null;
      const rssTextSpan = document.getElementById('rss-copy-text') as HTMLSpanElement | null;
      if (!rssCopyBtn || !rssTextSpan) return;

      const rssUrl = rssCopyBtn.getAttribute('data-rss-url') || 'https://log.1k.ink/rss.xml';
      const originalText = rssTextSpan.textContent;

      navigator.clipboard.writeText(rssUrl).then(() => {
        // å¤åˆ¶æˆåŠŸåé¦ˆ
        rssTextSpan.textContent = 'å·²å¤åˆ¶ ğŸ˜‹';

        setTimeout(() => {
          rssTextSpan.textContent = originalText || 'å¤åˆ¶é“¾æ¥';
        }, 2000);
      }).catch((err) => {
        console.error('RSSé“¾æ¥å¤åˆ¶å¤±è´¥:', err);
        rssTextSpan.textContent = 'âŒ å¤åˆ¶å¤±è´¥';
        setTimeout(() => {
          rssTextSpan.textContent = originalText || 'å¤åˆ¶é“¾æ¥';
        }, 2000);
      });
    };

    // RSSå¤åˆ¶æŒ‰é’®
    const rssCopyBtn = document.getElementById('rss-copy-btn');
    if (rssCopyBtn) {
      rssCopyBtn.addEventListener('click', copyRssLink);
    }

    // è‡ªåŠ¨ç”Ÿæˆæµ·æŠ¥
    generatePoster();
  }

  // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(initSidebarOfContents, 100);
    });
  } else {
    setTimeout(initSidebarOfContents, 100);
  }

  // ç›‘å¬ Astro é¡µé¢è½¬æ¢
  document.addEventListener('astro:after-swap', () => {
    setTimeout(initSidebarOfContents, 100);
  });
</script>
