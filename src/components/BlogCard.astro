---
import type { CollectionEntry } from 'astro:content';
import FormattedDate from './FormattedDate.astro';
import { getOriginalFileName } from '../utils/getOriginalFileName';
const defaultCover = '/img/df-cover.webp';

interface Props {
  post: CollectionEntry<'post'>;
  key?: string;
}

const { post } = Astro.props;
const { title, description, pubDate, heroImage, category, tags } = post.data;
const originalFileName = getOriginalFileName(post.id);
const displayImage = heroImage || defaultCover;
---

<article class="group relative bg-card-light dark:bg-card-dark rounded-3xl shadow-sm hover:-translate-y-2 hover:shadow-2xl transition-all duration-500 overflow-hidden">
  <div class="relative grid grid-rows-[auto_1fr]">
    {/* 封面图片区域 */}
    <a href={`/p/${originalFileName}.html`} class="relative overflow-hidden bg-hero-light dark:bg-hero-dark block" style="min-height: 220px;">
      <div
        class="absolute inset-0 bg-cover bg-center transition-transform duration-700 group-hover:scale-110"
        style={`background-image: url('${displayImage}');`}
        aria-label={title}
      ></div>
    </a>

    {/* 内容区域 */}
    <div class="relative p-7 flex flex-col items-start">
      {/* 元信息行 */}
      <div class="flex flex-row items-center gap-3 text-xs text-text-light dark:text-text-dark opacity-70 mb-4">
        <time class="flex items-center gap-1.5">
          <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <FormattedDate date={pubDate} />
        </time>
        {category && (
          <span class="flex items-center gap-1.5">
            <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
            {category}
          </span>
        )}
        <span class="flex items-center gap-1.5">
          <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          {Math.ceil((post.body?.length || 0) / 500)} 分钟阅读
        </span>
      </div>

      {/* 标题 - 现代排版 */}
      <h3 class="text-2xl font-bold mb-3 line-clamp-1">
        <a
          href={`/p/${originalFileName}.html`}
          class="text-text-light dark:text-text-dark hover:text-primary-light dark:hover:text-primary-dark transition-colors duration-300"
        >
          {title}
        </a>
      </h3>

      {/* 描述文字 */}
      <p class="text-sm text-text-light dark:text-text-dark line-clamp-1 opacity-75">
        {description}
      </p>
    </div>
  </div>
</article>
