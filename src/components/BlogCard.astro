---
import type { CollectionEntry } from 'astro:content';
import FormattedDate from './FormattedDate.astro';
import { getOriginalFileName } from '../utils/getOriginalFileName';
const defaultCover = '/img/df-cover.webp';

interface Props {
  post: CollectionEntry<'post'>;
  key?: string;
}

const { post } = Astro.props;
const { title, description, pubDate, heroImage, category, tags } = post.data;
const originalFileName = getOriginalFileName(post.id);
const displayImage = heroImage || defaultCover;
---

<article class="bg-card-light dark:bg-card-dark rounded-3xl shadow-sm hover:-translate-y-1 hover:shadow-xl transition-all duration-300 overflow-hidden border border-transparent hover:border-border-light dark:hover:border-border-dark">
  {/* 使用Grid布局实现自适应高度 */}
  <div class="grid grid-rows-[auto_1fr]">
    {/* 封面图片区域：设置最小高度确保美观 */}
    <a href={`/p/${originalFileName}.html`} class="relative overflow-hidden bg-hero-light dark:bg-hero-dark transition-transform duration-500 hover:scale-105 block" style="min-height: 180px;">
      <div
        class="absolute inset-0 bg-cover bg-center"
        style={`background-image: url('${displayImage}');`}
        aria-label={title}
      ></div>
    </a>
    
    {/* 内容区域：使用flex布局实现内部元素的垂直排列 */}
    <div class="p-6 flex flex-col justify-between">
      <div>
        <div class="flex flex-row items-center gap-2 text-xs text-text-light dark:text-text-dark opacity-80 mb-2">
          <time>
            <FormattedDate date={pubDate} />
          </time>
          <span class="text-gray-400">•</span>
          <span>{Math.ceil((post.body?.length || 0) / 500)} 分钟阅读</span>
        </div>
        <h3 class="text-lg font-bold mb-2 line-clamp-1">
          <a href={`/p/${originalFileName}.html`} class="text-text-light dark:text-text-dark hover:text-primary-light dark:hover:text-primary-dark transition-colors flex items-center">
            {title}
          </a>
        </h3>
      </div>
      <div>
        <p class="text-sm text-text-light dark:text-text-dark line-clamp-1 opacity-80 mb-3">
          {description}
        </p>
        <div class="flex flex-wrap items-center gap-2">
          {category && (
            <span class="px-2 py-1 text-xs font-medium bg-primary-light/10 text-primary-light dark:bg-primary-dark/10 dark:text-primary-dark rounded-full">
              {category}
            </span>
          )}
          {tags && tags.length > 0 && tags.slice(0, 3).map((tag) => (
            <span class="px-2 py-1 text-xs text-text-light dark:text-text-dark bg-hover-light dark:bg-hover-dark rounded-full">
              {tag}
            </span>
          ))}
          {tags && tags.length > 3 && (
            <span class="px-2 py-1 text-xs text-text-light dark:text-text-dark opacity-60">
              +{tags.length - 3}
            </span>
          )}
        </div>
      </div>
    </div>
  </div>
</article>
