---
import type { CollectionEntry } from 'astro:content';
import FormattedDate from './FormattedDate.astro';

interface Props {
  post: CollectionEntry<'post'>;
  key?: string;
}

const { post } = Astro.props;
const { title, description, pubDate, heroImage } = post.data;
const { id } = post;
---

<article class="bg-card-light dark:bg-card-dark rounded-xl shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden p-4 border border-border-light dark:border-border-dark">
  {/* 小屏幕：垂直布局，图片居中 */}
  {/* 中大屏幕：水平布局 */}
  <div class="flex flex-col md:flex-row gap-4">
    {/* 可选的封面图片 */}
    {heroImage && (
      <a href={`/post/${id}`} class="md:w-48 md:h-24 w-24 h-24 bg-hero-light dark:bg-hero-dark rounded-lg overflow-hidden flex-shrink-0 mx-auto md:mx-0 block">
        <div
          class="w-full h-full bg-cover bg-center"
          style={`background-image: url('${typeof heroImage === 'string' ? heroImage : heroImage.src}');`}
          aria-label={typeof heroImage === 'string' ? title : title}
        ></div>
      </a>
    )}
    
    {/* 内容区域 */}
    <div class="flex-1 min-w-0 text-center md:text-left">
      {/* 小屏幕：元数据在标题上方 */}
      <div class="md:hidden flex flex-col items-center gap-1 text-xs text-text-light dark:text-text-dark opacity-60 mb-2">
        <time>
          <FormattedDate date={pubDate} />
        </time>
        <span>{Math.ceil((post.body?.length || 0) / 500)} 分钟阅读</span>
      </div>
      
      <h3 class="text-lg font-bold mb-2">
        <a href={`/post/${id}`} class="text-text-light dark:text-text-dark hover:text-primary-light dark:hover:text-primary-dark transition-colors">
          {title}
        </a>
      </h3>
      
      {/* 显示完整摘要，不截断 */}
      <p class="text-sm text-text-light dark:text-text-dark opacity-90 mb-3 line-clamp-2">
        {description}
      </p>
      
      {/* 中大屏幕：元数据在描述下方 */}
      <div class="hidden md:flex flex-row items-center gap-2 text-xs text-text-light dark:text-text-dark opacity-60">
        <time>
          <FormattedDate date={pubDate} />
        </time>
        <span class="text-gray-400">•</span>
        <span>{Math.ceil((post.body?.length || 0) / 500)} 分钟阅读</span>
      </div>
      
      {/* 如果有标签或分类，可以在这里添加 */}
    </div>
  </div>
</article>
